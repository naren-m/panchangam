# Docker Compose configuration for Panchangam API testing

services:
  # Test framework service
  panchangam-tests:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: panchangam-test-runner
    volumes:
      # Mount the entire project for access to Go source code
      - ..:/workspace
      # Mount test outputs for persistence
      - ./reports:/app/reports
      - ./htmlcov:/app/htmlcov
      - ./logs:/app/logs
    working_dir: /workspace/test
    environment:
      - PANCHANGAM_API_URL=http://localhost:8080
      - SKIP_SERVER_START=false
      - PYTHONPATH=/workspace
      - PYTEST_DISABLE_PLUGIN_AUTOLOAD=1
    network_mode: host  # Use host network to access running servers
    command: tail -f /dev/null  # Keep container running for interactive use
    
  # Optional: Standalone test execution service
  test-runner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: panchangam-test-executor
    volumes:
      - ..:/workspace
      - ./reports:/app/reports
      - ./htmlcov:/app/htmlcov
    working_dir: /workspace/test
    environment:
      - PANCHANGAM_API_URL=http://localhost:8080
      - SKIP_SERVER_START=false
      - PYTHONPATH=/workspace
    network_mode: host  # Use host network to access running servers
    profiles:
      - testing
    command: python run_tests.py --verbose --coverage --html-report